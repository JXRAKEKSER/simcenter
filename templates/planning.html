{% extends "base.html" %}
{% block title %} AKT - {{ page_title }} {% endblock %}

{%- from "sb_manage.html" import sb_manage with context %}
{% block sidebar %}
{{ sb_manage() }}
{% endblock %}

{% block page_content %}
{% from "_helpers.html" import render_field with context %}
{% from "_modals.html" import qrModal %}

<style>
input[type=text], select {
  width: 40%;
  padding: 12px 20px;
  margin: 8px 0;
  display: inline-block;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
  box-shadow: 7px 7px 5px #888888;
}

.division1 {
  border-radius: 5px;
  background-color: #f2f2f2;
  padding: 20px;
}
</style>

<div class="col-md-12">
    <form method="POST" enctype="multipart/form-data" id="fm">
        <div class="panel panel-default">
            <div class="panel-heading text-center">
                <h3 class="text-muted ar1">
                    <strong>
                        <span class="fa fa-plus"></span>
                        {{ translate('Queue Planning ', 'en', [defLang]) }}
                    </strong>
                </h3>
            </div>
            <div class="panel-body">
                <p class="h3 text-center text-muted ar2">
                    | {{ translate("Планирование очереди", 'en', [defLang]) }} |
                </p>

                <div class="division1">
                    <center>
                        <p>
                            <label for="date" style="font-size:30px"></label>
                            <input type="text" id="date" name="date" placeholder="ДАТА" style="font-size:20px; width:40%; text-align:center" required><br><br>
                        </p>
                    </center>
                </div>

                <form class="form-inline">
                    <p>
                        <label for="nd" style="font-size:30px; color:#00bfff"><b>Начало дня</b></label><br>
                        <input type="text" id="nd" placeholder="час" name="nd" style="font-size:20px" required>
                        <input type="text" id="ndx" placeholder="минута" name="ndx" style="font-size:20px" required><br>
                        <label for="pwd" style="font-size:30px; color:#00bfff"><b>Конец дня</b></label><br>
                        <input type="text" id="pwd" placeholder="час" name="pwd" style="font-size:20px" required>
                        <input type="text" id="pwdx" placeholder="минута" name="pwdx" style="font-size:20px" required><br>
                        <label for="break" style="font-size:30px; color:#00bfff"><b>Перерыв</b></label><br>
                        <input type="text" id="break1" placeholder="Сколько часов" name="break2" style="font-size:20px" required>
                        <input type="text" id="break2" placeholder="Сколько минут" name="break3" style="font-size:20px" required>
                        <input type="text" id="break3" placeholder="После какого раунда" name="break1" style="font-size:20px" required>
                    </p><br>
                </form>

                <label for="break" style="font-size:30px; color:#00bfff"><b>Экзамен</b></label><br>
                <p><input type="text" id="name" name="time_ek" placeholder="Длительность экзамена" style="font-size:20px" required><br></p>
                <p><input type="text" id="name" name="time_pod" placeholder="Длительность подготовки" style="font-size:20px" required><br></p>

                <label for="sub" style="font-size:20px; color: green">
                    <h1><b>Специальность<b></h1>
                </label><br>
                <select name="special" method="GET" action="/plan" style="font-size:20px">
                    {% for spec in specialization %}
                        <option value="{{spec.name}}" SELECTED style="color:green">{{spec.name}} </option>
                    {% endfor %}
                </select>

                <h3 style="font-size:30px; color:#0377fc"><b>Количество потоков :</b></h3>
                <input type="text" id="txt2" name="count_p" required>

                <!-- Room selection for flow 1 -->
<h3 style="font-size:30px; color:#0377fc"><b>Список кабинетов для 1 потока<b></h3>
                        <div id="rooms-container-1">
                            <select name="contact1[]" class="room-dropdown-1" style="width: 40%">
                                <option value="">-- Select Room --</option>
                                {% for room in rooms %}
                                    <option value="{{ room.number }}">{{ room.number }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <button type="button" onclick="addRoomField(1)">Добавить кабинет</button>

                        <h3 style="font-size:30px; color:#0377fc"><b>Список кабинетов для 2 потока<b></h3>
                        <div id="rooms-container-2">
                            <select name="contact2[]" class="room-dropdown-2" style="width: 40%">
                                <option value="">-- Select Room --</option>
                                {% for room in rooms %}
                                    <option value="{{ room.number }}">{{ room.number }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <button type="button" onclick="addRoomField(2)">Добавить кабинет</button>

                        <h3 style="font-size:30px; color:#0377fc"><b>Список кабинетов для 3 потока<b></h3>
                        <div id="rooms-container-3">
                            <select name="contact3[]" class="room-dropdown-3" style="width: 40%">
                                <option value="">-- Select Room --</option>
                                {% for room in rooms %}
                                    <option value="{{ room.number }}">{{ room.number }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <button type="button" onclick="addRoomField(3)">Добавить кабинет</button>

                        <script>
                            let availableRooms = {{ rooms | tojson }};

                            function addRoomField(flow) {
                                let container = document.getElementById(`rooms-container-${flow}`);
                                let select = document.createElement('select');
                                select.name = `contact${flow}[]`;
                                select.classList.add(`room-dropdown-${flow}`);
                                select.style.width = "40%";

                                // Add default option
                                let defaultOption = document.createElement('option');
                                defaultOption.value = '';
                                defaultOption.text = '-- Select Room --';
                                select.appendChild(defaultOption);

                                // Populate the select with available rooms
                                availableRooms.forEach(room => {
                                    let option = document.createElement('option');
                                    option.value = room.number;
                                    option.text = room.number;
                                    select.appendChild(option);
                                });

                                container.appendChild(select);
                            }

                            // Logic to remove selected rooms from other dropdowns
                            document.querySelectorAll('select.room-dropdown-1, select.room-dropdown-2, select.room-dropdown-3').forEach(select => {
                                select.addEventListener('change', function() {
                                    let selectedRooms = [];
                                    document.querySelectorAll('select').forEach(sel => {
                                        if (sel.value !== '') {
                                            selectedRooms.push(sel.value);
                                        }
                                    });

                                    document.querySelectorAll('select').forEach(sel => {
                                        let currentValue = sel.value;
                                        sel.querySelectorAll('option').forEach(option => {
                                            if (selectedRooms.includes(option.value) && option.value !== currentValue) {
                                                option.disabled = true;
                                            } else {
                                                option.disabled = false;
                                            }
                                        });
                                    });
                                });
                            });
                        </script>

                <div id="dydiv"></div>

                <br><br>

                <p class="pb-5"></p>
                <center>
                    <button class="btn btn-md btn-danger" type="submit" id="saveBtn" value="Click" style="font-size:30px;">Сформировать очередь</button>
                </center>
                <p class="pb-2"></p>
            </div>
        </div>
    </form>
</div>

{{ qrModal([['mym', translate('Management template', 'en', [defLang]), url_for('static', filename='images/manage_map.jpg')]], close=translate('Exit', 'en', [defLang]))}}
{% endblock %}
